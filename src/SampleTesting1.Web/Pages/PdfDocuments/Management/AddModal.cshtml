@page
@using Microsoft.Extensions.Localization
@using SampleTesting1.Localization
@using SampleTesting1.Web.Pages.PdfDocuments.Management
@using Volo.Abp.AspNetCore.Mvc.UI.Bootstrap.TagHelpers.Modal
@model AddModalModel
@inject IStringLocalizer<SampleTesting1Resource> L
@{
    Layout = null;
}
<abp-dynamic-form abp-model="PdfDocument" asp-page="/PdfDocuments/Management/AddModal">
    <abp-modal>
        <abp-modal-header title="@L["NewPdfDocument"].Value"></abp-modal-header>
        <abp-modal-body>
            <abp-form-content />
            <div class="mb-3">
                <label class="form-label">@L["PdfFile"]</label>
                <input type="file" class="form-control" id="PdfFileInput" accept=".pdf" />
                <input type="hidden" asp-for="PdfDocument.PdfMediaId" id="PdfMediaIdInput" />
            </div>
        </abp-modal-body>
        <abp-modal-footer buttons="@(AbpModalButtons.Cancel|AbpModalButtons.Save)"></abp-modal-footer>
    </abp-modal>
</abp-dynamic-form>

<script>
    $(function () {
        var l = abp.localization.getResource('SampleTesting1');
        
        $('#PdfFileInput').on('change', function (e) {
            var file = e.target.files[0];
            if (!file) return;
            
            var formData = new FormData();
            formData.append('file', file);
            formData.append('name', file.name);
            
            abp.message.info(l('UploadingPdf'));
            
            // Upload to CMS Kit Media
            $.ajax({
                url: '/api/cms-kit-admin/media/database',
                type: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                success: function (response) {
                    $('#PdfMediaIdInput').val(response.id);
                    abp.message.success(l('PdfUploadedSuccessfully'));
                },
                error: function () {
                    abp.message.error(l('PdfUploadFailed'));
                }
            });
        });
    });
</script>
